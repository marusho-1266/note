<svg viewBox="0 0 800 700" xmlns="http://www.w3.org/2000/svg">
  <!-- Background -->
  <rect x="0" y="0" width="800" height="700" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="20" font-weight="bold" fill="#2c3e50">サービス層を含むMVCアーキテクチャ</text>
  
  <!-- Client/User Layer -->
  <rect x="300" y="70" width="200" height="60" rx="10" ry="10" fill="#9b59b6" stroke="#8e44ad" stroke-width="2"/>
  <text x="400" y="95" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Client</text>
  <text x="400" y="115" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">ブラウザ / モバイルアプリ</text>
  
  <!-- Controller Layer -->
  <rect x="300" y="180" width="200" height="60" rx="10" ry="10" fill="#27ae60" stroke="#229954" stroke-width="2"/>
  <text x="400" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Controller</text>
  <text x="400" y="225" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">リクエスト制御 / レスポンス生成</text>
  
  <!-- Service Layer (NEW) -->
  <rect x="300" y="290" width="200" height="60" rx="10" ry="10" fill="#f39c12" stroke="#e67e22" stroke-width="2"/>
  <text x="400" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Service</text>
  <text x="400" y="335" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">ビジネスロジック / アプリケーションロジック</text>
  
  <!-- Model Layer -->
  <rect x="300" y="400" width="200" height="60" rx="10" ry="10" fill="#e74c3c" stroke="#c0392b" stroke-width="2"/>
  <text x="400" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Model</text>
  <text x="400" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">データアクセス / エンティティ</text>
  
  <!-- Database Layer -->
  <rect x="300" y="510" width="200" height="60" rx="10" ry="10" fill="#34495e" stroke="#2c3e50" stroke-width="2"/>
  <text x="400" y="535" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Database</text>
  <text x="400" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">データ永続化</text>
  
  <!-- View Layer (side) -->
  <rect x="550" y="290" width="200" height="170" rx="10" ry="10" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="650" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">View</text>
  <text x="650" y="340" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">テンプレート</text>
  <text x="650" y="365" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">HTML/JSON レスポンス</text>
  <text x="650" y="390" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">UI コンポーネント</text>
  <text x="650" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">画面表示ロジック</text>
  
  <!-- Repository Pattern (optional layer) -->
  <rect x="50" y="400" width="200" height="60" rx="10" ry="10" fill="#16a085" stroke="#138d75" stroke-width="2"/>
  <text x="150" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Repository</text>
  <text x="150" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">データアクセス抽象化</text>
  
  <!-- Arrows -->
  <!-- Client to Controller -->
  <path d="M 400 130 L 400 180" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 400 180 L 400 130" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="410" y="155" font-family="Arial, sans-serif" font-size="11" fill="#34495e">HTTP Request/Response</text>
  
  <!-- Controller to Service -->
  <path d="M 400 240 L 400 290" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 400 290 L 400 240" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="410" y="265" font-family="Arial, sans-serif" font-size="11" fill="#34495e">業務処理呼び出し</text>
  
  <!-- Service to Model -->
  <path d="M 400 350 L 400 400" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 400 400 L 400 350" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="410" y="375" font-family="Arial, sans-serif" font-size="11" fill="#34495e">データ操作</text>
  
  <!-- Model to Database -->
  <path d="M 400 460 L 400 510" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 400 510 L 400 460" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="410" y="485" font-family="Arial, sans-serif" font-size="11" fill="#34495e">SQL/NoSQL</text>
  
  <!-- Controller to View -->
  <path d="M 500 210 L 550 320" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 550 350 L 500 240" stroke="#34495e" stroke-width="3" fill="none" marker-end="url(#arrowhead)"/>
  <text x="510" y="270" font-family="Arial, sans-serif" font-size="11" fill="#34495e">テンプレート</text>
  <text x="510" y="285" font-family="Arial, sans-serif" font-size="11" fill="#34495e">データ送信</text>
  
  <!-- Service to Repository (optional) -->
  <path d="M 300 320 L 250 400" stroke="#34495e" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrowhead)"/>
  <path d="M 250 430 L 300 350" stroke="#34495e" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrowhead)"/>
  <text x="210" y="365" font-family="Arial, sans-serif" font-size="10" fill="#34495e">（オプション）</text>
  
  <!-- Benefits box -->
  <rect x="50" y="600" width="700" height="80" rx="5" ry="5" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
  <text x="60" y="620" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2c3e50">サービス層導入の利点</text>
  <text x="60" y="640" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">• コントローラーの責務を軽減し、より良い分離を実現</text>
  <text x="60" y="655" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">• 複雑なビジネスロジックを一箇所に集約</text>
  <text x="400" y="655" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">• 単体テストが容易になる</text>
  <text x="60" y="670" font-family="Arial, sans-serif" font-size="12" fill="#2c3e50">• 複数のコントローラーから共通ロジックを再利用可能</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#34495e"/>
    </marker>
  </defs>
</svg>